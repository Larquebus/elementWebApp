#:kivy 1.10.1

# These widgets comprise the left hand side of the window, and involve displaying elements:
<ElementDisplay>:
	orientation: 'vertical'
	size: self.parent.size
	pos: self.parent.pos
	canvas:
		Color: 
			rgba: [1, 1, 1, 1]
		Rectangle:
			size: self.size
			pos: self.pos
	
<ElementDisplayBar>:
	size: self.parent.size
	pos: self.parent.pos
	orientation: 'horizontal'
	
	canvas.before:
		Color:
			rgba: [1, 1, 1, 1]
		Rectangle:
			size: self.size
			pos: self.pos
			
<SearchBar>:
	multiline: False
	on_text: self.dynamicSearch(self.text, self.filter)
	
<SearchResults>:
	results_tray: results_layout
	results_anchor: results_anchor
	pos: self.search_bar_pos
	size: self.search_bar_width, 125
	do_scroll_x: False
	scroll_y: 1
	size_hint: None, None
	AnchorLayout:
		id: results_anchor
		anchor_x: 'left'
		anchor_y: 'top'
		size_hint_y: None
		size: root.width, root.num_results * 25
		BoxLayout:
			id: results_layout
			orientation: 'vertical'
			size_hint: 1, None
			size: self.parent.size
					
<SearchResultBtn>:
	size_hint_y: None
	height: 25
	color: [0, 0, 0, 1]
	background_normal: ''
	background_color: self.type_color
	on_press: self.selectSearchResult()
	
<ElementDisplayWindow>:
	size: self.parent.size
	pos: self.parent.pos 
	
	canvas:
		Color:
			rgba: [1, 1, 1, 1]
		Rectangle:
			size: self.size
			pos: self.pos
			
<ElementFlat>:
	orientation: 'tb-lr'
	padding: 2
	spacing: 2			

<ElementWeb>:
	orientation: 'vertical'
	
	parent_layout: parent_layout
	
	relation_layout: relation_layout
	# Sub layouts of relation_layout:
	enemies_layout: enemies_layout
	focus_layout: focus_layout
	focus_el_anchor: focus_el_anchor
	allies_layout: allies_layout
	
	child_layout: child_layout
	
	WebRegion:
		LinkedElTray:
			id: parent_layout
			size_hint: None, None	
	WebRegion:
		BoxLayout:
			id: relation_layout
			orientation: 'horizontal'
			WebRegion:
				LinkedElTray:
					id: enemies_layout
					size_hint: None, None					
			BoxLayout:
				id: focus_layout
				orientation: 'horizontal'
				padding: 5
				WebRegion:
					size_hint_x: .2
					LinkElement:
						id: enemy_linker
						linker_type: 'enemies'
						search_orientation: 'left'
                        disabled: root.disable_relationships
				BoxLayout:
					orientation: 'vertical'
					padding: 5
					WebRegion:
						LinkElement:
							id: parent_linker
							linker_type: 'parents'
					WebRegion:
						id: focus_el_anchor
					WebRegion:
						LinkElement:
							id: child_linker
							linker_type: 'children'
				WebRegion:
					size_hint_x: .2
					LinkElement:
						id: ally_linker
						linker_type: 'allies'
						disabled: root.disable_relationships
			WebRegion:
				size_hint_y: 1
				LinkedElTray:
					id: allies_layout
					size_hint: None, None
	WebRegion:
		BoxLayout:
			id: child_layout
			size_hint: root.child_layout_width_hint, None
			height: root.child_layout_height
			orientation: 'horizontal'

		
<WebRegion>:
	anchor_x: 'center'
	anchor_y: 'center'
	
<LinkedElTray>:
	orientation: 'vertical'
	spacing: 2
	
<LinkHolder>:
	orientation: 'horizontal'
	size_hint: 1, 1
	link_anchor: link_anchor

	Button:
		height: self.parent.holder_height
		text: 'X'
		size_hint: .1, None
		on_press: self.parent.root_link.unLink(self.parent.unlinker_type, self.parent.element_id)
	AnchorLayout:
		id: link_anchor
		height: self.parent.holder_height
		size_hint: .9, None
		anchor_x: 'center'
		anchor_y: 'center'
	
<Element>:
	size: self.texture_size
	size_hint: (None, None)
	padding: 10, 10
	text: self.element_name
	font_name: 'Arial'
	background_normal: ''
	background_color: self.type_color
	color: [0, 0, 0, 1]
	bold: True
	
<NewElement>:
	size: 200, 50
	pos: self.pos
	size_hint: (None, None)
	orientation: 'vertical'
	Button:
		font_name: 'Arial'
		font_size: 14
		text: "Click to Add New Element"
		on_press: self.parent.nameNewElement()
	
<NewElementInput>:
	multiline: False
	on_text_validate: self.parent.addNewElementToWeb(self.text, self.parent.dropdown_btn.text)
	
<LinkElement>:
	size: 50, 50
	pos: self.pos
	size_hint: (None, None)
	orientation: 'vertical'
	link_button: link_button
	Button:
		id: link_button
		font_name: 'Arial'
		font_size: 14
		text: "+"
		on_press: self.parent.linkNewElement()
		
<LinkElementInput>:
	multiline: False

# These widgets comprise the right hand side of the window, and involve displaying element details:
<ElementDetails>:
	size: self.parent.size
	pos: self.parent.pos
	canvas:
		Color:
			rgba: [1, 1, 1, 1]
		Rectangle:
			size: self.size
			pos: self.pos
			
<ElementNotesFrame>:
	size: self.size
	pos: self.pos
			
<ElementNotes>:
	on_text: self.root_link.updateElementDetails(['notes'], self.text)
	
<CauseInput>:
	on_text: self.root_link.updateElementDetails(['cause'], self.text)
	
<TypeSpecificContent>:
	size: self.size
	pos: self.pos
	
<StatBubble>:
	size: 100, 100
	center: self.center
	size_hint: (None, None)
	canvas.before:
		Color:
			rgba: [0, 0, 0, 1]
		Ellipse:
			size: 56, 56
			pos: self.center_x - 28, self.center_y - 28
	canvas:
		Color:
			rgba: [1, 1, 1, 1]
		Ellipse:
			size: 52, 52
			pos: self.center_x - 26, self.center_y - 26
	Label:
		text: self.parent.stat
		color: [0, 0, 0, 1]
		pos: self.parent.pos
		
<StatToggles>:
	high_btn: high_btn
	med_btn: med_btn
	low_btn: low_btn
	pos: self.pos
	orientation: 'horizontal'
	size_hint: 1, .1
	ToggleButton:
		id: high_btn
		group: self.parent.stat_group
		text: 'H'
		size_hint: .3, 1
		on_press: self.parent.setStat(self.parent.stat_group, 0)
	ToggleButton:
		id: med_btn
		group: self.parent.stat_group
		text: 'M'
		size_hint: .3, 1
		on_press: self.parent.setStat(self.parent.stat_group, 1)
	ToggleButton:
		id: low_btn
		group: self.parent.stat_group
		text: 'L'
		size_hint: .3, 1
		on_press: self.parent.setStat(self.parent.stat_group, 2)
		
<Agenda>:
	button_bar: button_bar
	ambition_input: ambition_input
	opposition_input: opposition_input
	objective_tray: objective_tray
	support_tray: support_tray
	orientation: 'vertical'
	Label:
		text: 'Player Agenda'
		font_size: 16
		size_hint_y: .2
		color: [0, 0, 0, 1]	
	BoxLayout:
		id: button_bar
		orientation: 'horizontal'
		size_hint_y: .3
		Button:
			id: clear_agenda
			text: 'Clear Agenda'
			on_press: root.clearAgenda()
	Label:
		text: 'Ambition'
		size_hint_y: .15
		color: [0, 0, 0, 1]
	AgendaInput:
		id: ambition_input
		size_hint_y: .5
		on_text: root.root_link.updateElementDetails(['agenda', 'ambition'], self.text)
	Label:
		text: 'Opposition'
		size_hint_y: .15
		color: [0, 0, 0, 1]
	AgendaInput:
		id: opposition_input
		size_hint_y: .3
		on_text: root.root_link.updateElementDetails(['agenda', 'opposition'], self.text)
	Label:
		text: 'Objectives'
		size_hint_y: .15
		color: [0, 0, 0, 1]
	BoxLayout:
		id: objective_tray
		orientation: 'vertical'
		size_hint_y: 1.1
	Label:
		text: 'Support'
		size_hint_y: .15
		color: [0, 0, 0, 1]
	BoxLayout:
		id: support_tray
		orientation: 'vertical'		
		
		
<Objective>:
	objective_text: objective_text
	orientation: 'horizontal'
	AnchorLayout:
		anchor_x: 'center'
		anchor_y: 'center'
		size_hint_x: .1
		CheckBox:
			active: root.complete_ind
	TextInput:
		id: objective_text
		on_text: root.root_link.updateElementDetails(['objectives', root.obj_id, 'obj_text'], self.text)

# Build the widget tree:	
<AppFrame>:
	id: app_
	size: root.size
	pos: root.pos
	web: self.web_data
	element_details: element_details
	element_display: display
	static_search_bar: static_search_bar
	
	BoxLayout:
		orientation: 'horizontal'
		size: self.parent.size
		pos: self.parent.pos
		ElementDisplay:
			id: display
			size_hint: 1.3, 1
			display_window: display_window
			ElementDisplayBar:
				id: display_bar
				size_hint_y: .03
				Button:
					id: display_web_button
					size: self.size
					pos: self.pos
					text: 'Display Web'
					on_press: self.parent.parent.display_window.activateDisplay('web')
				Button:
					id: display_all_button
					size: self.size
					pos: self.pos
					text: 'Display All Elements'
					on_press: self.parent.parent.display_window.activateDisplay('flat')
			ElementDisplayWindow:
				id: display_window
			SearchBar:
				id: static_search_bar
				size_hint_y: .03
				results_orientation: 'above'
				parent_linker_type: None
		ElementDetails:
			id: element_details
			pos: self.pos
			size: self.size
			orientation: 'vertical'
			root_link: root
			detail_display_bar: detail_display_bar
			notes_container: notes_container
			type_content: type_content
			ElementDisplayBar:
				id: detail_display_bar
				size_hint_y: .06
				detail_display_label: detail_display_label
				Label:
					id: detail_display_label
					size: self.parent.size
					pos: 0, self.parent.center_y
					text: 'Currently selected: '
					color: [0, 0, 0, 1]
			ElementNotesFrame:
				id: notes_container
			TypeSpecificContent:
				id: type_content
				orientation: 'vertical'
				root_link: root

			

		