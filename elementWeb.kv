#:kivy 1.10.1

# These widgets comprise the left hand side of the window, and involve displaying elements:
<ElementDisplay>:
	orientation: 'vertical'
	size: self.parent.size
	pos: self.parent.pos
	canvas:
		Color: 
			rgba: [1, 1, 1, 1]
		Rectangle:
			size: self.size
			pos: self.pos
	
<ElementDisplayBar>:
	size: self.parent.size
	pos: self.parent.pos
	orientation: 'horizontal'
	
	canvas.before:
		Color:
			rgba: [1, 1, 1, 1]
		Rectangle:
			size: self.size
			pos: self.pos
			
<SearchAndSelect>:
	search_input: search_input
	results_tray: results_tray
	results_anchor: results_anchor
	
	BoxLayout:
		orientation: 'vertical'	
		pos: root.search_pos
		size: root.search_size
		size_hint: None, None
		TextInput:
			id: search_input
			multiline: False
			size_hint_y: .2
			on_text: root.dynamicSearch(self.text, root.filter)
		ScrollView:
			do_scroll_x: False
			pos: self.pos
			scroll_y: 1
			canvas:
				Color:
					rgba: [1, 1, 1, .1]
				Rectangle:
					size: self.size
					pos: self.pos
			AnchorLayout:
				id: results_anchor
				anchor_x: 'left'
				anchor_y: 'top'
				size_hint_y: None
				size: root.x, root.num_results * 25
				BoxLayout:
					id: results_tray
					orientation: 'vertical'
					size_hint: 1, None
					size: self.parent.size
					
<SearchResultBtn>:
	size_hint_y: None
	height: 25
	color: [0, 0, 0, 1]
	background_normal: ''
	background_color: self.type_color
	on_press: self.selectSearchResult()
	
<ElementDisplayWindow>:
	size: self.parent.size
	pos: self.parent.pos 
	
	canvas:
		Color:
			rgba: [1, 1, 1, 1]
		Rectangle:
			size: self.size
			pos: self.pos
			
<ElementFlat>:
	orientation: 'tb-lr'
	padding: 2
	spacing: 2			

<ElementWeb>:
	orientation: 'vertical'
	
	parent_layout: parent_layout
	
	relation_layout: relation_layout
	# Sub layouts of relation_layout:
	enemies_layout: enemies_layout
	focus_layout: focus_layout
	focus_el_anchor: focus_el_anchor
	allies_layout: allies_layout
	
	child_layout: child_layout
	
	WebRegion:
		LinkedElTray:
			id: parent_layout
			size_hint: None, None	
	WebRegion:
		BoxLayout:
			id: relation_layout
			orientation: 'horizontal'
			WebRegion:
				LinkedElTray:
					id: enemies_layout
					size_hint: None, None
			BoxLayout:
				id: focus_layout
				orientation: 'horizontal'
				padding: 5
				WebRegion:
					size_hint_x: .2
					LinkElement:
						id: enemy_linker
						linker_type: 'enemies'
						search_orientation: 'left'
				BoxLayout:
					orientation: 'vertical'
					padding: 5
					WebRegion:
						LinkElement:
							id: parent_linker
							linker_type: 'parents'
					WebRegion:
						id: focus_el_anchor
					WebRegion:
						LinkElement:
							id: child_linker
							linker_type: 'children'
				WebRegion:
					size_hint_x: .2
					LinkElement:
						id: ally_linker
						linker_type: 'allies'
			WebRegion:
				LinkedElTray:
					id: allies_layout
					size_hint: None, None				
	WebRegion:
		BoxLayout:
			id: child_layout
			size_hint: root.child_layout_size, None
			orientation: 'horizontal'

		
<WebRegion>:
	anchor_x: 'center'
	anchor_y: 'center'
	
<LinkedElTray>:
	orientation: 'vertical'
	spacing: 2
	
<Element>:
	size: len(self.element_name) * 10, 50
	size_hint: (None, None)
	text: self.element_name
	font_name: 'Arial'
	background_normal: ''
	background_color: self.type_color
	color: [0, 0, 0, 1]
	bold: True
	
<NewElement>:
	size: 200, 50
	pos: self.pos
	size_hint: (None, None)
	orientation: 'vertical'
	Button:
		font_name: 'Arial'
		font_size: 14
		text: "Click to Add New Element"
		on_press: self.parent.nameNewElement()
	
<NewElementInput>:
	multiline: False
	on_text_validate: self.parent.addNewElementToWeb(self.text, self.parent.dropdown_btn.text)
	
<LinkElement>:
	size: 50, 50
	pos: self.pos
	size_hint: (None, None)
	orientation: 'vertical'
	link_button: link_button
	Button:
		id: link_button
		font_name: 'Arial'
		font_size: 14
		text: "+"
		on_press: self.parent.linkNewElement()
		
<LinkElementInput>:
	multiline: False

# These widgets comprise the right hand side of the window, and involve displaying element details:
<ElementDetails>:
	size: self.parent.size
	pos: self.parent.pos
	canvas:
		Color:
			rgba: [1, 1, 1, 1]
		Rectangle:
			size: self.size
			pos: self.pos
			
<ElementNotesFrame>:
	size: self.size
	pos: self.pos
			
<ElementNotes>:
	on_text: self.root_link.updateElement('notes', self.text)
	
<CauseInput>:
	on_text: self.root_link.updateElement('cause', self.text)
	
<TypeSpecificContent>:
	size: self.size
	pos: self.pos
	
<StatBubble>:
	size: 100, 100
	center: self.center
	size_hint: (None, None)
	canvas.before:
		Color:
			rgba: [0, 0, 0, 1]
		Ellipse:
			size: 56, 56
			pos: self.center_x - 28, self.center_y - 28
	canvas:
		Color:
			rgba: [1, 1, 1, 1]
		Ellipse:
			size: 52, 52
			pos: self.center_x - 26, self.center_y - 26
	Label:
		text: self.parent.stat
		color: [0, 0, 0, 1]
		pos: self.parent.pos	

# Build the widget tree:	
<AppFrame>:
	id: app_
	size: root.size
	pos: root.pos
	web: self.web_data
	element_details: element_details
	element_display: display
	
	BoxLayout:
		orientation: 'horizontal'
		size: self.parent.size
		pos: self.parent.pos
		ElementDisplay:
			id: display
			size_hint: 1.3, 1
			display_window: display_window
			ElementDisplayBar:
				id: display_bar
				size_hint_y: .03
				Button:
					id: display_web_button
					size: self.size
					pos: self.pos
					text: 'Display Web'
					on_press: self.parent.parent.display_window.activateDisplay('web')
				Button:
					id: display_all_button
					size: self.size
					pos: self.pos
					text: 'Display All Elements'
					on_press: self.parent.parent.display_window.activateDisplay('flat')
			ElementDisplayWindow:
				id: display_window
		ElementDetails:
			id: element_details
			pos: self.pos
			size: self.size
			orientation: 'vertical'
			root_link: root
			detail_display_bar: detail_display_bar
			notes_container: notes_container
			type_content: type_content
			ElementDisplayBar:
				id: detail_display_bar
				size_hint_y: .06
				detail_display_label: detail_display_label
				Label:
					id: detail_display_label
					size: self.parent.size
					pos: 0, self.parent.center_y
					text: 'Currently selected: '
					color: [0, 0, 0, 1]
			ElementNotesFrame:
				id: notes_container
			TypeSpecificContent:
				id: type_content
				orientation: 'vertical'
				root_link: root

			

		